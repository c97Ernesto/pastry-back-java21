<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layout/main}">

<head>
    <title th:text="${pageTitle}">Usuario</title>
</head>

<body>
    <div layout:fragment="content">

        <!-- Back Link -->
        <div class="mb-6">
            <a th:href="@{/users}"
                class="inline-flex items-center gap-2 text-gray-600 hover:text-primary-600 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Volver a usuarios
            </a>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden max-w-2xl">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900"
                    th:text="${user.id != null} ? 'Editar Usuario' : 'Nuevo Usuario'">Formulario</h2>
            </div>

            <form th:action="${user.id != null} ? @{/users/{id}(id=${user.id})} : @{/users}" method="post"
                class="p-6 space-y-6">

                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <!-- Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                        Nombre <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="name" name="name" th:value="${user.name}" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Ingrese el nombre">
                    <p th:if="${#fields.hasErrors('name')}" class="mt-1 text-sm text-red-600" th:errors="*{name}"></p>
                </div>

                <!-- Last Name -->
                <div>
                    <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">
                        Apellido
                    </label>
                    <input type="text" id="lastName" name="lastName" th:value="${user.lastName}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Ingrese el apellido">
                    <p th:if="${#fields.hasErrors('lastName')}" class="mt-1 text-sm text-red-600"
                        th:errors="*{lastName}"></p>
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                        Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" id="email" name="email" th:value="${user.email}" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500"
                        placeholder="usuario@ejemplo.com">
                    <p th:if="${#fields.hasErrors('email')}" class="mt-1 text-sm text-red-600" th:errors="*{email}"></p>
                </div>

                <!-- Password -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
                        Contraseña
                        <span th:if="${user.id == null}" class="text-red-500">*</span>
                        <span th:if="${user.id != null}" class="text-gray-400 text-xs">(dejar vacío para no
                            cambiar)</span>
                    </label>
                    <input type="password" id="password" name="password" th:required="${user.id == null}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500"
                        placeholder="••••••••">
                    <p th:if="${#fields.hasErrors('password')}" class="mt-1 text-sm text-red-600"
                        th:errors="*{password}"></p>
                </div>

                <!-- Role -->
                <div>
                    <label for="roleId" class="block text-sm font-medium text-gray-700 mb-1">
                        Rol <span class="text-red-500">*</span>
                    </label>
                    <select id="roleId" name="roleId" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-500 focus:border-primary-500 bg-white">
                        <option value="">Seleccione un rol</option>
                        <option th:each="role : ${roles}" th:value="${role.id}" th:text="${role.name.name()}"
                            th:selected="${user.role != null && user.role.id == role.id}">Rol</option>
                    </select>
                    <p th:if="${#fields.hasErrors('roleId')}" class="mt-1 text-sm text-red-600" th:errors="*{roleId}">
                    </p>
                </div>

                <!-- Enabled -->
                <div class="flex items-center gap-3">
                    <input type="checkbox" id="enabled" name="enabled"
                        th:checked="${user.enabled != null ? user.enabled : true}"
                        class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                    <label for="enabled" class="text-sm font-medium text-gray-700">
                        Usuario habilitado
                    </label>
                </div>

                <!-- Error Message -->
                <div th:if="${error}" class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                    <span th:text="${error}"></span>
                </div>

                <!-- Actions -->
                <div class="flex items-center gap-3 pt-4 border-t border-gray-200">
                    <button type="submit"
                        class="inline-flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span th:text="${user.id != null} ? 'Actualizar' : 'Crear'">Guardar</span>
                    </button>
                    <a th:href="@{/users}"
                        class="inline-flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>

    </div>
</body>

</html>